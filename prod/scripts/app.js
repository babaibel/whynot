$(function(){var e=$(".js-f-events");if(e.length){var t=e.find("form"),o=$(".js-fevents-counter"),n=e.data("query-url");_GLOB.refreshFindEventCounter=function(){$.ajax({type:"GET",url:n,data:t.serialize(),success:function(e){var t=JSON.parse(e);o.text(t.eventsCountStr)}})},t.find("input").bind("input change",function(){_GLOB.refreshFindEventCounter()})}}),$(function(){function e(){0!=b?l.removeClass("_disabled"):l.addClass("_disabled"),b==g-7?p.addClass("_disabled"):p.removeClass("_disabled")}function t(t,o){var n="prev"==t?l:p;n.hasClass("_disabled")||("prev"==t&&0!=b&&(b-=1),"next"==t&&b!=g-7&&(b+=1),d.css("left",-(b*k)+"%"),c.css("left",-(b*k)+"%"),e())}function o(e){var t,o,n="",s=e.getDate();switch(e.getMonth()){case 0:t="янв";break;case 1:t="фев";break;case 2:t="март";break;case 3:t="апр";break;case 4:t="май";break;case 5:t="июн";break;case 6:t="июл";break;case 7:t="авг";break;case 8:t="сен";break;case 9:t="окт";break;case 10:t="ноя";break;case 11:t="дек"}switch(e.getDay()){case 1:o="пн";break;case 2:o="вт";break;case 3:o="ср";break;case 4:o="чт";break;case 5:o="пт";break;case 6:o="сб";break;case 7:o="вс";break;case 0:o="вс"}return n+=s+" <small>"+t+", "+o+"</small>"}function n(){var e,t=a.get(),n=new Date;n.setDate(n.getDate()+Number(t[0])),r.eq(0).html(o(n)),e=n.getDate()+".",e+=n.getMonth()+1<10?"0"+(n.getMonth()+1):n.getMonth()+1,e+="."+n.getFullYear(),n=new Date,n.setDate(n.getDate()+Number(t[1])),r.eq(1).html(o(n)),e+=" - "+n.getDate()+".",e+=n.getMonth()+1<10?"0"+(n.getMonth()+1):n.getMonth()+1,e+="."+n.getFullYear(),f.val(e)}function s(){var e=a.get();h.css("left",e[0]*k+"%"),h.css("width",(e[1]-e[0])*k+"%")}var i=$(".js-weekrange");if(i.length){var a,r,c=$(".js-weekrange-ui"),l=i.find(".js-weekrange__arr-l"),p=i.find(".js-weekrange__arr-r"),u=i.find(".js-weekrange-date"),d=i.find(".js-weekrange-tracker"),h=i.find(".js-weekrange-v-line"),f=$(".js-f-events-date"),g=u.length,v=[0,5],b=0,k=100/7;c.css("width",k*g+"%"),noUiSlider.create(c[0],{start:v,connect:!1,range:{min:0,max:g-1},step:1,tooltips:[!0,!0]}),a=c[0].noUiSlider,r=$(".noUi-tooltip"),a.on("slide",function(o,i,a){return n(),s(),e(),_GLOB.refreshFindEventCounter(),i?void(a[1]>b+6?t("next"):a[1]<b&&t("prev")):i?void(v=a):void(a[0]>b+6?t("next"):a[0]<b&&t("prev"))}),n(),l.bind("click",function(){t("prev",$(this))}),p.bind("click",function(){t("next",$(this))})}}),$(function(){var e=$(".js-weekrange-datepicker");if(e.length){var t=$(".js-f-events-date"),o=new Date;e.datepicker({inline:!0,minDate:o,onSelect:function(e){t.val(e),_GLOB.refreshFindEventCounter()}})}}),$(function(){var e=$(".js-chkb-dropdown");e.length&&e.each(function(){var e=$(this),t=e.find(".js-chkb-dropdown__btn"),o=e.data("resol");t.bind("click",function(){$W.width()<=_GLOB.breakpoints[o]&&e.toggleClass("_active")})})}),$(function(){var e=$(".js-passw-input");e.length&&e.each(function(){var e=$(this),t=e.find(".js-password-toggle"),o=$(this).find("input");t.bind("click",function(){var t=e.hasClass("_pass-visible");t?(e.removeClass("_pass-visible"),o.attr("type","password")):(e.addClass("_pass-visible"),o.attr("type","text"))})})}),$(function(){var e=$(".js-header-search"),t=$(".js-header-search-trigger");if(t.length){var o=$W.scrollTop();t.bind("click",function(){e.toggleClass("_expanded"),$W.bind("click",function(t){var o=$(t.target);o.closest(".js-header-search").length||(e.removeClass("_expanded"),$W.unbind("click"))})}),$W.scroll(function(){var e=$W.scrollTop();o>=e&&e>200?$B.addClass("_search-open"):$B.removeClass("_search-open"),o=e})}}),$(function(){var e=$(".js-header-menu-btn");e.length&&e.bind("click",function(t){$B.toggleClass("_header-menu-open"),$W.bind("click",function(t){var o=$(t.target);o.closest(".js-header-menu").length||o.closest(e).length||($B.removeClass("_header-menu-open"),$W.unbind("click"))}),t.stopPropagation()})});var $W=$(window),$D=$(document),$H=$("html"),$B=$("body"),_POPUPS={},_GLOB={breakpoints:{xxl:1920,xl:1599,xx:1500,lx:1400,l:1279,ll:1099,m:979,mm:859,s:767,sm:669,ss:579,xs:479,xxs:320}};$(function(){var e=$(".js-bookmark");e.length&&e.on("click",function(){$(this).toggleClass("active")})}),$(function(){var e=$(".js-bookmark-remove");e.length&&e.on("click",function(){$(this).next(".js-bookmark-tooltip").fadeIn(50)})}),$(function(){var e=$(".js-close-tooltip");e.length&&e.on("click",function(){$(this).closest(".js-bookmark-tooltip").fadeOut(50)})}),$(function(){var e=$(".js-cards-filter");if(e.length){var t=$(".js-cards-filter").find("a");t.on("click",function(){$(this).addClass("active"),t.not(this).removeClass("active")})}}),$(function(){function e(e){a=new ymaps.Placemark(e,{balloonContentHeader:"Вы здесь!"},{iconLayout:"default#image",iconImageHref:"../images/svg/marker.svg",iconImageSize:[44,44],iconImageOffset:[-22,-22],balloonPanelMaxMapArea:0}),i.geoObjects.add(a),i.setCenter(e),$.ajax({type:"GET",url:"queries/getClosestOnMap.php",data:{lat:e[0],lon:e[1]},success:function(e){var o=JSON.parse(e);t(o)}})}function t(e){var t=[];p.removeAll(),$.each(e,function(e,o){var n,s;switch(o.type){case"zoo":n="zoo",s="../images/mark-lion.png";break;case"food":n="food",s="../images/mark-gulp.png";break;case"atraction":n="atraction",s="../images/mark-atraction.png"}console.log(s),t[e]=new ymaps.Placemark([o.lat,o.lon],{balloonContentHeader:o.title,balloonContentBody:'<div class="">'+o.html+"</div>"},{iconLayout:"default#image",iconImageHref:s,iconImageSize:[95,65],iconImageOffset:[-26,-32.5],balloonPanelMaxMapArea:0})}),p.add(t),i.geoObjects.add(p)}function o(){navigator.geolocation&&navigator.geolocation.getCurrentPosition?r.get({provider:"browser",mapStateAutoApply:!0}).then(function(t){c=t.geoObjects.get(0).geometry._coordinates,e(c)}):r.get({provider:"yandex",mapStateAutoApply:!0}).then(function(t){c=t.geoObjects.get(0).geometry._coordinates,e(c)})}function n(){r=ymaps.geolocation,i=new ymaps.Map(s,{center:d,zoom:15,controls:[]}),i.controls.add("zoomControl",{"float":"none",position:{top:215,right:20}}),i.behaviors.disable("scrollZoom"),l=function(){return ymaps.templateLayoutFactory.createClass('<div class="eventsCluster">{{ properties.geoObjects.length }}</div>')},p=new ymaps.Clusterer({groupByCoordinates:!1,clusterHideIconOnBalloonOpen:!1,geoObjectHideIconOnBalloonOpen:!1,clusterIcons:[{href:"../images/svg/marker.svg",size:[44,44],offset:[-22,-22]}],clusterIconContentLayout:l(),clusterBalloonItemContentLayout:ymaps.templateLayoutFactory.createClass('<div class="ballon_body">{{ properties.balloonContentBody|raw }}</div><div class="ballon_footer">{{ properties.balloonContentFooter|raw }}</div>')}),o()}var s="js-closest-map";if($("#"+s).length){var i,a,r,c,l,p,u=$(".js-closest-map_btn"),d=[55.75396,37.620393];ymaps.ready(n),u.bind("click",function(){o()})}}),$(function(){function e(e,t){this.popup=e,this.openStatus=!1,this.settings={closeSelector:".js-popup-closer"};var o=this.settings,n=this;for(var s in t)this.settings[s]=t[s];if(o.toStick&&(this.toStick=o.toStick,$W.resize(function(){n.setStick()}),$W.scroll(function(){n.setStick()})),this.settings.centerX&&(this.centerX=o.centerX,$W.resize(function(){n.setCenterX()}),$W.scroll(function(){n.setCenterX()})),o.closeSelector){var i=this.popup.find(o.closeSelector);i&&this.popup.find(o.closeSelector).bind("click",function(){n.close()})}}e.prototype.setStick=function(){var e,t,o=this.toStick,n=o.offset(),s=this.settings.vertical,i=this.settings.horizontal;s&&n&&(e=n[s[0]],"bottom"==s[0]&&(e=$W.height()-n.top-o.outerHeight(),this.popup.css("top","initial")),"out"==s[1]&&("bottom"==s[0]?e-=o.outerHeight():e+=o.outerHeight()),this.popup.css(s[0],e)),i&&n&&(t=n[i[0]],"right"==i[0]&&(t=$W.width()-n.left-o.outerWidth(),this.popup.css("left","initial")),"out"==i[1]&&("right"==i[0]?t-=o.outerWidth():t+=o.outerWidth()),this.popup.css(i[0],t))},e.prototype.setCenterX=function(){var e=0,t=this.popup.outerHeight(),o=$W.height();e=t>o?0:(o-t)/2,"absolute"==this.popup.css("position")&&(e+=$W.scrollTop()),this.popup.css("top",e)},e.prototype.open=function(e){var t=this;this.settings.toStick&&this.setStick(),this.settings.centerX&&this.setCenterX(),this.popup.addClass("_active"),$W.bind("click",function(e){$(e.target).closest(t.popup).length||(t.close(),$W.unbind("click"))}),this.settings.onOpen&&this.settings.onOpen(t),e&&e.stopPropagation(),this.openStatus=!0},e.prototype.close=function(){this.popup.removeClass("_active"),this.openStatus=!1},e.prototype.toggle=function(e){this.openStatus?this.close(e):this.open(e)},$(".js-popup").each(function(){var t=$(this),o=t.data("popup-name");_POPUPS[o]=new e(t)}),_POPUPS.login=new e($(".js-popup-login"),{toStick:$('.js-popup-btn[data-popup-name="login"]'),horizontal:["right","in"],vertical:["top","out"]}),_POPUPS.subscribe=new e($(".js-popup-subs"),{toStick:$('.js-popup-btn[data-popup-name="subscribe"]'),horizontal:["left","in"],vertical:["top","out"]})}),$(function(){var e=$(".js-popup-btn");e.length&&e.each(function(){var e=$(this),t=e.data("popup-name");e.bind("click",function(e){_POPUPS[t].toggle(e)})})}),function(e){e.fn.customSelector=function(t){e(this).each(function(){function o(){i.toggle(),n.toggleClass("_open")}var n=e(this),s=n.find(".js-selector-current"),i=n.find(".js-selector-options"),a=n.find(".js-selector-input").length?n.find(".js-selector-input"):n.find('input[type="hidden"]'),r={};for(var c in t)r[c]=t[c];s.bind("click",function(t){a.prop("disabled")||(o(),$W.bind("click",function(t){n.hasClass("_open")&&!e(t.target).closest(n).length&&(o(),$D.unbind("click"))}),t.preventDefault())}),i.find(".js-selector-option").bind("click",function(){var t=e(this),n=t.data("option-name")||t.text();if(r.beforeSelect){var c=r.beforeSelect(t,i.find(".js-selector-option"),e.trim(n));if(0==c)return!1}if(s.html(e(this).html()),a&&a.val(n),o(),r.afterSelect){var l=r.afterSelect(t,i.find(".js-selector-option"));if(0==l)return!1}})})}}(jQuery),function(){var e=$(".js-selector");e.length&&e.customSelector({beforeSelect:function(){console.log("before select")}})}(jQuery),_GLOB.slickArrLeftHtml='<button class="slick-arrow slick-prev"></button>',_GLOB.slickArrRightHtml='<button class="slick-arrow slick-next"></button>',$(function(){var e=$(".js-actions-sl");e.length&&e.slick({slidesToShow:1,slidesToScroll:1,dots:!1,adaptiveHeight:!0,prevArrow:_GLOB.slickArrLeftHtml,nextArrow:_GLOB.slickArrRightHtml,swipe:!1,responsive:[{breakpoint:_GLOB.breakpoints.sm,settings:{swipe:!0}}]})}),$(function(){var e=$(".js-actions-sl2");e.length&&e.slick({slidesToShow:1,slidesToScroll:1,dots:!0,adaptiveHeight:!0,prevArrow:_GLOB.slickArrLeftHtml,nextArrow:_GLOB.slickArrRightHtml,swipe:!1,responsive:[{breakpoint:_GLOB.breakpoints.sm,settings:{swipe:!0}}]})}),$(function(){var e=$(".js-recom-sl");e.length&&e.slick({slidesToShow:2,slidesToScroll:2,dots:!1,arrows:!0,adaptiveHeight:!0,prevArrow:'<button class="slick-arrow2 slick-prev"></button>',nextArrow:'<button class="slick-arrow2 slick-next"></button>',swipe:!1,responsive:[{breakpoint:_GLOB.breakpoints.mm,settings:{swipe:!0}},{breakpoint:_GLOB.breakpoints.sm,settings:{slidesToShow:1,slidesToScroll:1,arrows:!1,dots:!0,swipe:!0}}]})});