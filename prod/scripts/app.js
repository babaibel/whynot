$(function(){var e=$(".js-filter-param");e.length&&e.each(function(){var t=$(this),n=t.find(".js-filter-param__btn");n.bind("click",function(n){t.hasClass("_open");e.not(t).removeClass("_open"),t.toggleClass("_open"),n.stopPropagation(),$W.bind("click",function(e){var n=$(e.target),o=!(n.closest(".datepicker--cell").length||n.closest(".datepicker--nav-title").length||n.closest(".datepicker--nav-action").length||n.closest(t).length);o&&(t.removeClass("_open"),$W.unbind("click"))})})})}),$(function(){var e=$(".js-filter"),t=$(".js-filter__mob-toggle");(e.length||t.length)&&t.bind("click",function(){$B.toggleClass("_m-filter-open"),$W.bind("click",function(t){var n=$(t.target),o=!(n.closest(e).length||n.closest(".datepicker--cell").length||n.closest(".datepicker--nav-title").length||n.closest(".datepicker--nav-action").length);o&&($B.removeClass("_m-filter-open"),$W.unbind("click"))})})}),$(function(){var e=$(".js-f-events");if(e.length){var t=e.find("form"),n=$(".js-fevents-counter"),o=e.data("query-url");_GLOB.refreshFindEventCounter=function(){$.ajax({type:"GET",url:o,data:t.serialize(),success:function(e){var t=JSON.parse(e);n.text(t.eventsCountStr)}})},t.find("input").bind("input change",function(){_GLOB.refreshFindEventCounter()})}}),$(function(){function e(){0!=k?l.removeClass("_disabled"):l.addClass("_disabled"),k==f-7?p.addClass("_disabled"):p.removeClass("_disabled")}function t(t,n){var o="prev"==t?l:p;o.hasClass("_disabled")||("prev"==t&&0!=k&&(k-=1),"next"==t&&k!=f-7&&(k+=1),d.css("left",-(k*b)+"%"),c.css("left",-(k*b)+"%"),e())}function n(e){var t,n,o="",s=e.getDate();switch(e.getMonth()){case 0:t="янв";break;case 1:t="фев";break;case 2:t="март";break;case 3:t="апр";break;case 4:t="май";break;case 5:t="июн";break;case 6:t="июл";break;case 7:t="авг";break;case 8:t="сен";break;case 9:t="окт";break;case 10:t="ноя";break;case 11:t="дек"}switch(e.getDay()){case 1:n="пн";break;case 2:n="вт";break;case 3:n="ср";break;case 4:n="чт";break;case 5:n="пт";break;case 6:n="сб";break;case 7:n="вс";break;case 0:n="вс"}return o+=s+" <small>"+t+", "+n+"</small>"}function o(){var e,t=a.get(),o=new Date;o.setDate(o.getDate()+Number(t[0])),r.eq(0).html(n(o)),e=o.getDate()+".",e+=o.getMonth()+1<10?"0"+(o.getMonth()+1):o.getMonth()+1,e+="."+o.getFullYear(),o=new Date,o.setDate(o.getDate()+Number(t[1])),r.eq(1).html(n(o)),e+=" - "+o.getDate()+".",e+=o.getMonth()+1<10?"0"+(o.getMonth()+1):o.getMonth()+1,e+="."+o.getFullYear(),h.val(e)}function s(){var e=a.get();g.css("left",e[0]*b+"%"),g.css("width",(e[1]-e[0])*b+"%")}var i=$(".js-weekrange");if(i.length){var a,r,c=$(".js-weekrange-ui"),l=i.find(".js-weekrange__arr-l"),p=i.find(".js-weekrange__arr-r"),u=i.find(".js-weekrange-date"),d=i.find(".js-weekrange-tracker"),g=i.find(".js-weekrange-v-line"),h=$(".js-f-events-date"),f=u.length,v=[0,5],k=0,b=100/7;c.css("width",b*f+"%"),noUiSlider.create(c[0],{start:v,connect:!1,range:{min:0,max:f-1},step:1,tooltips:[!0,!0]}),a=c[0].noUiSlider,r=$(".noUi-tooltip"),a.on("slide",function(n,i,a){return o(),s(),e(),_GLOB.refreshFindEventCounter(),i?void(a[1]>k+6?t("next"):a[1]<k&&t("prev")):i?void(v=a):void(a[0]>k+6?t("next"):a[0]<k&&t("prev"))}),o(),l.bind("click",function(){t("prev",$(this))}),p.bind("click",function(){t("next",$(this))})}}),$(function(){var e=$(".js-weekrange-datepicker");if(e.length){var t=$(".js-f-events-date"),n=new Date;e.datepicker({inline:!0,minDate:n,onSelect:function(e){t.val(e),_GLOB.refreshFindEventCounter()}})}}),$(function(){var e=$(".js-chkb-dropdown");e.length&&e.each(function(){var e=$(this),t=e.find(".js-chkb-dropdown__btn"),n=e.data("resol");t.bind("click",function(){$W.width()<=_GLOB.breakpoints[n]&&(e.toggleClass("_active"),$W.bind("click",function(t){var n=$(t.target),o=!(n.closest(".datepicker--cell").length||n.closest(".datepicker--nav-title").length||n.closest(".datepicker--nav-action").length||n.closest(e).length);o&&e.removeClass("_active")}))})})}),$(function(){var e=$(".js-passw-input");e.length&&e.each(function(){var e=$(this),t=e.find(".js-password-toggle"),n=$(this).find("input");t.bind("click",function(){var t=e.hasClass("_pass-visible");t?(e.removeClass("_pass-visible"),n.attr("type","password")):(e.addClass("_pass-visible"),n.attr("type","text"))})})}),$(function(){var e=$(".js-datepicker");e.length&&e.each(function(){var e=$(this),t=e.data("inline");e.datepicker({inline:t})})}),function(e){e.fn.imgSimpleUpload=function(t){var n=e(this),o=n.find('input[type="file"]'),s=n.data("min-w"),i=n.data("min-w");o.bind("change input",function(e){var a=new FileReader,r=o[0].files[0];a.onload=function(e){return function(e){var a=e.target.result,r=new Image;return r.src=a,r.width<s&&r.height<i?void o.val(""):("bg"==t.type&&n.css("background-image","url('"+a+"')"),"img"==t.type&&n.html('<img src="'+a+'">'),void n.addClass("_loaded"))}}(r),a.readAsDataURL(r)})}}(jQuery),function(e){e.fn.onlyListedKeys=function(t){e(this).each(function(){var n=e(this),o=n.val();n.bind("change input",function(){var e=n.val();t.test(e)?o=e:n.val(o)})})}}(jQuery),$(function(){var e=$(".js-ava-upload");e.length&&e.each(function(){var e=$(this);$(this).imgSimpleUpload({target:e,type:"bg"})})}),$(function(){var e=$(".js-only-digits");e.length&&e.onlyListedKeys(/^([0-9](\.)?(-)?(,)?){0,}$/)}),$(function(){var e=$(".js-header-search"),t=$(".js-header-search-trigger");if(t.length){var n=$W.scrollTop();t.bind("click",function(){e.toggleClass("_expanded"),$W.bind("click",function(t){var n=$(t.target);n.closest(".js-header-search").length||(e.removeClass("_expanded"),$W.unbind("click"))})}),$W.scroll(function(){var e=$W.scrollTop();n>=e&&e>200?$B.addClass("_search-open"):$B.removeClass("_search-open"),n=e})}}),$(function(){var e=$(".js-header-menu-btn");e.length&&e.bind("click",function(t){$B.toggleClass("_header-menu-open"),$W.bind("click",function(t){var n=$(t.target);n.closest(".js-header-menu").length||n.closest(e).length||($B.removeClass("_header-menu-open"),$W.unbind("click"))}),t.stopPropagation()})});var $W=$(window),$D=$(document),$H=$("html"),$B=$("body"),_POPUPS={},_GLOB={breakpoints:{xxl:1920,xl:1599,xx:1500,lx:1400,l:1279,ll:1099,m:979,mm:859,s:767,sm:669,ss:579,xs:479,xxs:320}};$(function(){var e=$(".js-bookmark");e.length&&e.on("click",function(){$(this).toggleClass("active")})}),$(function(){var e=$(".js-bookmark-remove");e.length&&e.on("click",function(){$(this).next(".js-bookmark-tooltip").fadeIn(50)})}),$(function(){var e=$(".js-close-tooltip");e.length&&e.on("click",function(){$(this).closest(".js-bookmark-tooltip").fadeOut(50)})}),$(function(){var e=$(".js-cards-filter");if(e.length){var t=$(".js-cards-filter").find("a");t.on("click",function(){$(this).addClass("active"),t.not(this).removeClass("active")})}}),$(function(){function e(e){a=new ymaps.Placemark(e,{balloonContentHeader:"Вы здесь!"},{iconLayout:"default#image",iconImageHref:"../images/svg/marker.svg",iconImageSize:[44,44],iconImageOffset:[-22,-22],balloonPanelMaxMapArea:0}),i.geoObjects.add(a),i.setCenter(e),$.ajax({type:"GET",url:"queries/getClosestOnMap.php",data:{lat:e[0],lon:e[1]},success:function(e){var n=JSON.parse(e);t(n)}})}function t(e){var t=[];p.removeAll(),$.each(e,function(e,n){var o,s;switch(n.type){case"zoo":o="zoo",s="../images/mark-lion.png";break;case"food":o="food",s="../images/mark-gulp.png";break;case"atraction":o="atraction",s="../images/mark-atraction.png"}console.log(s),t[e]=new ymaps.Placemark([n.lat,n.lon],{balloonContentHeader:n.title,balloonContentBody:'<div class="">'+n.html+"</div>"},{iconLayout:"default#image",iconImageHref:s,iconImageSize:[95,65],iconImageOffset:[-26,-32.5],balloonPanelMaxMapArea:0})}),p.add(t),i.geoObjects.add(p)}function n(){navigator.geolocation&&navigator.geolocation.getCurrentPosition?r.get({provider:"browser",mapStateAutoApply:!0}).then(function(t){c=t.geoObjects.get(0).geometry._coordinates,e(c)}):r.get({provider:"yandex",mapStateAutoApply:!0}).then(function(t){c=t.geoObjects.get(0).geometry._coordinates,e(c)})}function o(){r=ymaps.geolocation,i=new ymaps.Map(s,{center:d,zoom:15,controls:[]}),i.controls.add("zoomControl",{"float":"none",position:{top:215,right:20}}),i.behaviors.disable("scrollZoom"),l=function(){return ymaps.templateLayoutFactory.createClass('<div class="eventsCluster">{{ properties.geoObjects.length }}</div>')},p=new ymaps.Clusterer({groupByCoordinates:!1,clusterHideIconOnBalloonOpen:!1,geoObjectHideIconOnBalloonOpen:!1,clusterIcons:[{href:"../images/svg/marker.svg",size:[44,44],offset:[-22,-22]}],clusterIconContentLayout:l(),clusterBalloonItemContentLayout:ymaps.templateLayoutFactory.createClass('<div class="ballon_body">{{ properties.balloonContentBody|raw }}</div><div class="ballon_footer">{{ properties.balloonContentFooter|raw }}</div>')}),n()}var s="js-closest-map";if($("#"+s).length){var i,a,r,c,l,p,u=$(".js-closest-map_btn"),d=[55.75396,37.620393];ymaps.ready(o),u.bind("click",function(){n()})}}),$(function(){function e(e,t){this.popup=e,this.openStatus=!1,this.settings={closeSelector:".js-popup-closer"};var n=this.settings,o=this;for(var s in t)this.settings[s]=t[s];if(n.toStick&&(this.toStick=n.toStick,$W.resize(function(){o.setStick()}),$W.scroll(function(){o.setStick()})),this.settings.centerX&&(this.centerX=n.centerX,$W.resize(function(){o.setCenterX()}),$W.scroll(function(){o.setCenterX()})),n.closeSelector){var i=this.popup.find(n.closeSelector);i&&this.popup.find(n.closeSelector).bind("click",function(){o.close()})}}e.prototype.setStick=function(){var e,t,n=this.toStick,o=n.offset(),s=this.settings.vertical,i=this.settings.horizontal;s&&o&&(e=o[s[0]],"bottom"==s[0]&&(e=$W.height()-o.top-n.outerHeight(),this.popup.css("top","initial")),"out"==s[1]&&("bottom"==s[0]?e-=n.outerHeight():e+=n.outerHeight()),this.popup.css(s[0],e)),i&&o&&(t=o[i[0]],"right"==i[0]&&(t=$W.width()-o.left-n.outerWidth(),this.popup.css("left","initial")),"out"==i[1]&&("right"==i[0]?t-=n.outerWidth():t+=n.outerWidth()),this.popup.css(i[0],t))},e.prototype.setCenterX=function(){var e=0,t=this.popup.outerHeight(),n=$W.height();e=t>n?0:(n-t)/2,"absolute"==this.popup.css("position")&&(e+=$W.scrollTop()),this.popup.css("top",e)},e.prototype.open=function(e){var t=this;this.settings.toStick&&this.setStick(),this.settings.centerX&&this.setCenterX(),this.popup.addClass("_active"),$W.bind("click",function(e){$(e.target).closest(t.popup).length||(t.close(),$W.unbind("click"))}),this.settings.onOpen&&this.settings.onOpen(t),e&&e.stopPropagation(),this.openStatus=!0},e.prototype.close=function(){this.popup.removeClass("_active"),this.openStatus=!1},e.prototype.toggle=function(e){this.openStatus?this.close(e):this.open(e)},$(".js-popup").each(function(){var t=$(this),n=t.data("popup-name");_POPUPS[n]=new e(t)}),_POPUPS.login=new e($(".js-popup-login"),{toStick:$('.js-popup-btn[data-popup-name="login"]'),horizontal:["right","in"],vertical:["top","out"]}),_POPUPS.subscribe=new e($(".js-popup-subs"),{toStick:$('.js-popup-btn[data-popup-name="subscribe"]'),horizontal:["left","in"],vertical:["top","out"]})}),$(function(){var e=$(".js-popup-btn");e.length&&e.each(function(){var e=$(this),t=e.data("popup-name");e.bind("click",function(e){_POPUPS[t].toggle(e)})})}),function(e){e.fn.customSelector=function(t){e(this).each(function(){function n(){i.toggle(),o.toggleClass("_open")}var o=e(this),s=o.find(".js-selector-current"),i=o.find(".js-selector-options"),a=o.find(".js-selector-input").length?o.find(".js-selector-input"):o.find('input[type="hidden"]'),r={};for(var c in t)r[c]=t[c];s.bind("click",function(t){a.prop("disabled")||(n(),$W.bind("click",function(t){o.hasClass("_open")&&!e(t.target).closest(o).length&&(n(),$D.unbind("click"))}),t.preventDefault())}),i.find(".js-selector-option").bind("click",function(){var t=e(this),o=t.data("option-name")||t.text();if(r.beforeSelect){var c=r.beforeSelect(t,i.find(".js-selector-option"),e.trim(o));if(0==c)return!1}if(s.html(e(this).html()),a&&a.val(o),n(),r.afterSelect){var l=r.afterSelect(t,i.find(".js-selector-option"));if(0==l)return!1}})})}}(jQuery),function(){var e=$(".js-selector");e.length&&e.customSelector({beforeSelect:function(){console.log("before select")}})}(jQuery),_GLOB.slickArrLeftHtml='<button class="slick-arrow slick-prev"></button>',_GLOB.slickArrRightHtml='<button class="slick-arrow slick-next"></button>',$(function(){var e=$(".js-actions-sl");e.length&&e.slick({slidesToShow:1,slidesToScroll:1,dots:!1,adaptiveHeight:!0,prevArrow:_GLOB.slickArrLeftHtml,nextArrow:_GLOB.slickArrRightHtml,swipe:!1,responsive:[{breakpoint:_GLOB.breakpoints.sm,settings:{swipe:!0}}]})}),$(function(){var e=$(".js-actions-sl2");e.length&&e.slick({slidesToShow:1,slidesToScroll:1,dots:!0,adaptiveHeight:!0,prevArrow:_GLOB.slickArrLeftHtml,nextArrow:_GLOB.slickArrRightHtml,swipe:!1,responsive:[{breakpoint:_GLOB.breakpoints.sm,settings:{swipe:!0}}]})}),$(function(){var e=$(".js-recom-sl");e.length&&e.slick({slidesToShow:2,slidesToScroll:2,dots:!1,arrows:!0,adaptiveHeight:!0,prevArrow:'<button class="slick-arrow2 slick-prev"></button>',nextArrow:'<button class="slick-arrow2 slick-next"></button>',swipe:!1,responsive:[{breakpoint:_GLOB.breakpoints.mm,settings:{swipe:!0}},{breakpoint:_GLOB.breakpoints.sm,settings:{slidesToShow:1,slidesToScroll:1,arrows:!1,dots:!0,swipe:!0}}]})});